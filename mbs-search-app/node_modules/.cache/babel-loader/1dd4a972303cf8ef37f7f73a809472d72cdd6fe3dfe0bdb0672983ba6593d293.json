{"ast":null,"code":"const AZURE_SEARCH_ENDPOINT = 'https://testopenaiservice102.search.windows.net';\nconst AZURE_SEARCH_API_KEY = 'cEbz7StL7nXVJ2wx6VNO9fXzw1m9hbhtdgTwkBFY90AzSeAQGwJ2';\nconst AZURE_SEARCH_INDEX = 'azuresql-index-v2';\nconst buildFilterString = filters => {\n  if (!filters || Object.keys(filters).length === 0) {\n    return '';\n  }\n  const filterParts = [];\n  Object.entries(filters).forEach(([field, values]) => {\n    if (values && values.length > 0) {\n      const fieldFilters = values.map(value => {\n        // Check if the field is a string type and needs quotes\n        if (['Category', 'SubGroup', 'SubHeading', 'ScheduleId', 'ItemNum'].includes(field)) {\n          return `${field} eq ${value}`;\n        } else {\n          return `${field} eq '${value}'`;\n        }\n      });\n      if (fieldFilters.length === 1) {\n        filterParts.push(fieldFilters[0]);\n      } else {\n        filterParts.push(`(${fieldFilters.join(' or ')})`);\n      }\n    }\n  });\n  return filterParts.join(' and ');\n};\nconst getFacetableFields = () => {\n  return ['CategoryDescription', 'GroupDescription', 'ItemType', 'ItemTypeDesciption', 'ProviderType', 'FeeType', 'FeeTypeName', 'BenefitType', 'NewItem', 'ItemChange', 'FeeChange'];\n};\nexport const searchMBS = async (query, filters = {}, page = 1, pageSize = 10, sortBy = '') => {\n  const skip = (page - 1) * pageSize;\n  const filterString = buildFilterString(filters);\n  const facetString = getFacetableFields().join(',');\n\n  // Build request parameters\n  const params = new URLSearchParams({\n    'api-version': '2020-06-30',\n    'search': query,\n    'searchFields': 'Description,HumanReadableDescription,ItemNumAlias,CategoryDescription,GroupDescription',\n    'searchMode': 'all',\n    'queryType': 'simple',\n    'count': 'true',\n    'facets': facetString,\n    '$skip': skip.toString(),\n    '$top': pageSize.toString(),\n    '$select': '*'\n  });\n\n  // Add filter if present\n  if (filterString) {\n    params.append('$filter', filterString);\n  }\n\n  // Add orderby if present\n  if (sortBy) {\n    params.append('$orderby', sortBy);\n  }\n  try {\n    const response = await fetch(`${AZURE_SEARCH_ENDPOINT}/indexes/${AZURE_SEARCH_INDEX}/docs/search?${params.toString()}`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'api-key': AZURE_SEARCH_API_KEY\n      },\n      body: JSON.stringify({\n        search: query,\n        searchFields: \"Description,HumanReadableDescription,ItemNumAlias,CategoryDescription,GroupDescription\",\n        searchMode: \"all\",\n        queryType: \"simple\",\n        count: true,\n        facets: facetString,\n        skip: skip,\n        top: pageSize,\n        filter: filterString || undefined,\n        orderby: sortBy || undefined\n      })\n    });\n    if (!response.ok) {\n      var _errorData$error;\n      const errorData = await response.json();\n      throw new Error(`Search API error: ${((_errorData$error = errorData.error) === null || _errorData$error === void 0 ? void 0 : _errorData$error.message) || response.statusText}`);\n    }\n    const data = await response.json();\n\n    // Process facets\n    const processedFacets = {};\n    if (data['@search.facets']) {\n      Object.entries(data['@search.facets']).forEach(([facetName, facetValues]) => {\n        processedFacets[facetName] = facetValues.map(facet => ({\n          value: facet.value,\n          count: facet.count\n        }));\n      });\n    }\n    return {\n      results: data.value || [],\n      facets: processedFacets,\n      count: data['@odata.count'] || 0\n    };\n  } catch (error) {\n    console.error('Search service error:', error);\n    throw error;\n  }\n};","map":{"version":3,"names":["AZURE_SEARCH_ENDPOINT","AZURE_SEARCH_API_KEY","AZURE_SEARCH_INDEX","buildFilterString","filters","Object","keys","length","filterParts","entries","forEach","field","values","fieldFilters","map","value","includes","push","join","getFacetableFields","searchMBS","query","page","pageSize","sortBy","skip","filterString","facetString","params","URLSearchParams","toString","append","response","fetch","method","headers","body","JSON","stringify","search","searchFields","searchMode","queryType","count","facets","top","filter","undefined","orderby","ok","_errorData$error","errorData","json","Error","error","message","statusText","data","processedFacets","facetName","facetValues","facet","results","console"],"sources":["C:/Projects/MBSSearchReact/mbs-search-app/src/services/searchService.js"],"sourcesContent":["const AZURE_SEARCH_ENDPOINT = 'https://testopenaiservice102.search.windows.net';\nconst AZURE_SEARCH_API_KEY = 'cEbz7StL7nXVJ2wx6VNO9fXzw1m9hbhtdgTwkBFY90AzSeAQGwJ2';\nconst AZURE_SEARCH_INDEX = 'azuresql-index-v2';\n\nconst buildFilterString = (filters) => {\n  if (!filters || Object.keys(filters).length === 0) {\n    return '';\n  }\n  \n  const filterParts = [];\n  \n  Object.entries(filters).forEach(([field, values]) => {\n    if (values && values.length > 0) {\n      const fieldFilters = values.map(value => {\n        // Check if the field is a string type and needs quotes\n        if (['Category', 'SubGroup', 'SubHeading', 'ScheduleId', 'ItemNum'].includes(field)) {\n          return `${field} eq ${value}`;\n        } else {\n          return `${field} eq '${value}'`;\n        }\n      });\n      \n      if (fieldFilters.length === 1) {\n        filterParts.push(fieldFilters[0]);\n      } else {\n        filterParts.push(`(${fieldFilters.join(' or ')})`);\n      }\n    }\n  });\n  \n  return filterParts.join(' and ');\n};\n\nconst getFacetableFields = () => {\n  return [\n    'CategoryDescription',\n    'GroupDescription',\n    'ItemType',\n    'ItemTypeDesciption',\n    'ProviderType',\n    'FeeType',\n    'FeeTypeName',\n    'BenefitType',\n    'NewItem',\n    'ItemChange',\n    'FeeChange'\n  ];\n};\n\nexport const searchMBS = async (query, filters = {}, page = 1, pageSize = 10, sortBy = '') => {\n  const skip = (page - 1) * pageSize;\n  const filterString = buildFilterString(filters);\n  const facetString = getFacetableFields().join(',');\n  \n  // Build request parameters\n  const params = new URLSearchParams({\n    'api-version': '2020-06-30',\n    'search': query,\n    'searchFields': 'Description,HumanReadableDescription,ItemNumAlias,CategoryDescription,GroupDescription',\n    'searchMode': 'all',\n    'queryType': 'simple',\n    'count': 'true',\n    'facets': facetString,\n    '$skip': skip.toString(),\n    '$top': pageSize.toString(),\n    '$select': '*'\n  });\n  \n  // Add filter if present\n  if (filterString) {\n    params.append('$filter', filterString);\n  }\n  \n  // Add orderby if present\n  if (sortBy) {\n    params.append('$orderby', sortBy);\n  }\n  \n  try {\n    const response = await fetch(`${AZURE_SEARCH_ENDPOINT}/indexes/${AZURE_SEARCH_INDEX}/docs/search?${params.toString()}`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'api-key': AZURE_SEARCH_API_KEY\n      },\n      body: JSON.stringify({\n        search: query,\n        searchFields: \"Description,HumanReadableDescription,ItemNumAlias,CategoryDescription,GroupDescription\",\n        searchMode: \"all\",\n        queryType: \"simple\",\n        count: true,\n        facets: facetString,\n        skip: skip,\n        top: pageSize,\n        filter: filterString || undefined,\n        orderby: sortBy || undefined\n      })\n    });\n    \n    if (!response.ok) {\n      const errorData = await response.json();\n      throw new Error(`Search API error: ${errorData.error?.message || response.statusText}`);\n    }\n    \n    const data = await response.json();\n    \n    // Process facets\n    const processedFacets = {};\n    if (data['@search.facets']) {\n      Object.entries(data['@search.facets']).forEach(([facetName, facetValues]) => {\n        processedFacets[facetName] = facetValues.map(facet => ({\n          value: facet.value,\n          count: facet.count\n        }));\n      });\n    }\n    \n    return {\n      results: data.value || [],\n      facets: processedFacets,\n      count: data['@odata.count'] || 0\n    };\n  } catch (error) {\n    console.error('Search service error:', error);\n    throw error;\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}